<div class="draws-container">
  <div class="header-section">
    <h1 class="page-title">
      <i class="pi pi-gift"></i>
      Lucky Draws Management
    </h1>
    <p class="page-subtitle">Manage and execute lucky draws</p>
  </div>

  <p-card class="draws-card">
    <div class="table-header">
      <p-iconField iconPosition="left">
        <p-inputIcon styleClass="pi pi-search" />
        <input type="text" pInputText placeholder="Search draws..." class="search-input" #searchInput
          (input)="dt.filterGlobal(searchInput.value, 'contains')" />
      </p-iconField>
      <button pButton label="Create New Draw" icon="pi pi-plus" class="p-button-success"
        (click)="openCreateDrawModal()">
      </button>
    </div>

    <p-table #dt [value]="draws" [loading]="loading" [paginator]="true" [rows]="10" [rowsPerPageOptions]="[5, 10, 20]"
      [showCurrentPageReport]="true" currentPageReportTemplate="Showing {first} to {last} of {totalRecords} draws"
      [globalFilterFields]="['prizeName', 'drawDate']" styleClass="p-datatable-gridlines p-datatable-striped"
      [tableStyle]="{'min-width': '50rem'}">

      <ng-template pTemplate="header">
        <tr>
          <th style="width: 4rem">#</th>
          <th pSortableColumn="prizeName">
            Prize
            <p-sortIcon field="prizeName"></p-sortIcon>
          </th>
          <th pSortableColumn="drawDate">
            Draw Date
            <p-sortIcon field="drawDate"></p-sortIcon>
          </th>
          <th pSortableColumn="participants">
            Participants
            <p-sortIcon field="participants"></p-sortIcon>
          </th>
          <th>Status</th>
          <th style="width: 12rem">Actions</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-draw let-rowIndex="rowIndex">
        <tr>
          <td>{{ rowIndex + 1 }}</td>
          <td>
            <div class="prize-cell">
              <i class="pi pi-gift prize-icon"></i>
              <span class="prize-name">{{ draw.prizeName }}</span>
            </div>
          </td>
          <td>
            <div class="date-cell">
              <i class="pi pi-calendar"></i>
              {{ formatDate(draw.drawDate) }}
            </div>
          </td>
          <td>
            <div class="participants-cell clickable" (click)="viewParticipants(draw)">
              <i class="pi pi-users"></i>
              <span class="count">{{ draw.participants || 0 }}</span>
            </div>
          </td>
          <td>
            <p-tag [value]="draw.status" [severity]="getStatusSeverity(draw.status)">
            </p-tag>
          </td>
          <td>
            <div class="action-buttons">
              <button pButton pRipple icon="pi pi-pencil" class="p-button-rounded p-button-info p-button-sm"
                pTooltip="Edit User" (click)="openEditDrawModal(draw.id)">
              </button>
              <button pButton pRipple icon="pi pi-users" class="p-button-rounded p-button-info p-button-text"
                pTooltip="View Participants" tooltipPosition="top" (click)="viewParticipants(draw)">
              </button>
              <button pButton pRipple icon="pi pi-play" class="p-button-rounded p-button-success p-button-text"
                pTooltip="Run Draw" tooltipPosition="top" (click)="runDraw(draw)">
              </button>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="6" class="empty-message">
            <div class="empty-state">
              <i class="pi pi-inbox"></i>
              <p>No lucky draws found</p>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="loadingbody">
        <tr>
          <td colspan="6">
            <div class="loading-container">
              <i class="pi pi-spin pi-spinner"></i>
              <span>Loading draws...</span>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>

</div>

<!-- Modal Component -->
<app-create-draw [(visible)]="showDrawModal" [drawId]="selectedDrawId" (drawCreated)="onDrawCreated()">
</app-create-draw>
